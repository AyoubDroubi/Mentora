# ?? ???? ?????? (Domain Layer) - ???? ????

## ?? ?????????
- [???? ????](#????-????)
- [???????? ????????](#????????-????????)
- [?????????](#?????????)
- [???????? ??? ????????](#????????-???-????????)
- [????? ???????](#?????-???????)
- [BaseEntity](#baseentity)

---

## ?? ???? ????

???? Domain ?? **??? ???????** ?????? ???:
- ? ???????? (Entities)
- ? ????? ??????? (Business Rules)
- ? ????????? (Enums)
- ? ?????? ??????? (BaseEntity)
- ? **??** ????? ??? ?? ???? ????
- ? **??** ????? ??? ?? ?????? ??????

### ????? ???????

```
???????????????????????????????????????????
?        Domain Layer Principles          ?
???????????????????????????????????????????
?                                         ?
?  ? Pure .NET (No Dependencies)        ?
?  ? POCO (Plain Old CLR Objects)       ?
?  ? Business Logic Only                ?
?  ? Framework Independent              ?
?  ? Testable                           ?
?                                         ?
???????????????????????????????????????????
```

---

## ?? ???????? ????????

### 1. ?? User (????????)

**??????:** `Entities/Auth/User.cs`

```csharp
public class User : BaseEntity
{
    // ??????? ??????
    public string FirstName { get; set; } = string.Empty;
    public string LastName { get; set; } = string.Empty;
    public string Email { get; set; } = string.Empty;
    public string PasswordHash { get; set; } = string.Empty;
    
    // ???? ??????
    public bool IsEmailConfirmed { get; set; } = false;
    public DateTime? LastLoginAt { get; set; }
    
    // ?????? ??????
    public UserProfile? UserProfile { get; set; }
    public ICollection<RefreshToken> RefreshTokens { get; set; } = new List<RefreshToken>();
    public ICollection<CareerPlan> CareerPlans { get; set; } = new List<CareerPlan>();
    public ICollection<StudyPlan> StudyPlans { get; set; } = new List<StudyPlan>();
    
    // ????? ?????? (Computed Property)
    public string FullName => $"{FirstName} {LastName}";
}
```

**???????:**
- ? ????? ??? ????????? ???????? ???
- ? `PasswordHash` ???? `Password` (??????)
- ? ?????? One-to-One ? One-to-Many
- ? ????? ?????? ????? ??????

---

### 2. ?? UserProfile (????? ??????)

**??????:** `Entities/UserProfile.cs`

```csharp
public class UserProfile : BaseEntity
{
    // ??????? ????????
    public Guid UserId { get; set; }
    public User User { get; set; } = null!;
    
    // ??????? ?????
    public string? Bio { get; set; }
    public DateTime? DateOfBirth { get; set; }
    public string? PhoneNumber { get; set; }
    
    // ??????? ?????
    public string? CurrentRole { get; set; }
    public string? TargetRole { get; set; }
    public int? YearsOfExperience { get; set; }
    
    // ????????
    public ICollection<UserSkill> Skills { get; set; } = new List<UserSkill>();
    public ICollection<UserAchievement> Achievements { get; set; } = new List<UserAchievement>();
}
```

**???????:**
- ? ????? One-to-One ?? User
- ? ??????? ???????? (nullable)
- ? ????? ??? ???????? ??????????

---

### 3. ?? CareerPlan (??? ?????? ??????)

**??????:** `Entities/CareerPlan.cs`

```csharp
public class CareerPlan : BaseEntity
{
    // ??????? ?????
    public Guid UserId { get; set; }
    public User User { get; set; } = null!;
    
    public string Title { get; set; } = string.Empty;
    public string TargetRole { get; set; } = string.Empty;
    public string Description { get; set; } = string.Empty;
    public string Summary { get; set; } = string.Empty;
    
    // ?????? ??????
    public int TimelineMonths { get; set; } = 12;
    public int CurrentStepIndex { get; set; } = 0;
    
    // ??????
    public bool IsActive { get; set; } = true;
    public PlanStatus Status { get; set; } = PlanStatus.Active;
    
    // ???????
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    
    // ????????
    public ICollection<CareerStep> Steps { get; set; } = new List<CareerStep>();
}
```

**???????:**
- ? ????? Many-to-One ?? User
- ? ????? One-to-Many ?? CareerStep
- ? ???? ?????? (CurrentStepIndex)
- ? ???? ????? (PlanStatus)

---

### 4. ?? CareerStep (???? ?????? ??????)

**??????:** `Entities/CareerStep.cs`

```csharp
public class CareerStep : BaseEntity
{
    // ??????? ??????
    public Guid CareerPlanId { get; set; }
    public CareerPlan CareerPlan { get; set; } = null!;
    
    public int StepNumber { get; set; }
    public string Title { get; set; } = string.Empty;
    public string Description { get; set; } = string.Empty;
    
    // ????? ???????
    public int EstimatedDurationDays { get; set; }
    public CareerStepStatus Status { get; set; } = CareerStepStatus.NotStarted;
    
    // ????????
    public DateTime? StartedAt { get; set; }
    public DateTime? CompletedAt { get; set; }
    public DateTime? DueDate { get; set; }
}
```

**???????:**
- ? ????? Many-to-One ?? CareerPlan
- ? ????? ????? (StepNumber)
- ? ???? ????? (Started, Completed, Due)

---

### 5. ?? StudyPlan (??? ???????)

**??????:** `Entities/StudyPlan.cs`

```csharp
public class StudyPlan : BaseEntity
{
    // ??????? ?????
    public Guid UserId { get; set; }
    public User User { get; set; } = null!;
    
    public string Title { get; set; } = string.Empty;
    public string Subject { get; set; } = string.Empty;
    public string Description { get; set; } = string.Empty;
    
    // ?????? ??????
    public DateTime StartDate { get; set; }
    public DateTime EndDate { get; set; }
    
    // ??????
    public bool IsActive { get; set; } = true;
    public PlanStatus Status { get; set; } = PlanStatus.Active;
}
```

**???????:**
- ? ????? Many-to-One ?? User
- ? ???? ???? ???? (StartDate, EndDate)

---

### 6. ?? Skill (????????)

**??????:** `Entities/Skill.cs`

```csharp
public class Skill : BaseEntity
{
    public string Name { get; set; } = string.Empty;
    public string Category { get; set; } = string.Empty;
    public string? Description { get; set; }
    
    // ????????
    public ICollection<UserSkill> UserSkills { get; set; } = new List<UserSkill>();
}
```

**???????:**
- ? Master Data (?????? ??????)
- ? ?????? ??? ?????? ???????

---

### 7. ?? UserSkill (?????? ????????)

**??????:** `Entities/UserSkill.cs`

```csharp
public class UserSkill : BaseEntity
{
    // ????????
    public Guid UserProfileId { get; set; }
    public UserProfile UserProfile { get; set; } = null!;
    
    public Guid SkillId { get; set; }
    public Skill Skill { get; set; } = null!;
    
    // ????? ???????
    public int ProficiencyLevel { get; set; } // 0-100
    public SkillLevel Level { get; set; } = SkillLevel.Beginner;
    
    // ????????
    public DateTime AcquiredAt { get; set; } = DateTime.UtcNow;
}
```

**???????:**
- ? Many-to-Many Relationship (Join Table)
- ? ????? ????? ???????

---

### 8. ?? UserAchievement (??????? ????????)

**??????:** `Entities/UserAchievement.cs`

```csharp
public class UserAchievement : BaseEntity
{
    public Guid UserProfileId { get; set; }
    public UserProfile UserProfile { get; set; } = null!;
    
    public string Title { get; set; } = string.Empty;
    public string Description { get; set; } = string.Empty;
    public DateTime AchievedAt { get; set; } = DateTime.UtcNow;
}
```

---

### 9. ?? RefreshToken (?????? ?????????)

**??????:** `Entities/RefreshToken.cs`

```csharp
public class RefreshToken : BaseEntity
{
    public string Token { get; set; } = string.Empty;
    public Guid UserId { get; set; }
    public User User { get; set; } = null!;
    
    // ??????? ??????
    public string? DeviceInfo { get; set; }
    public string? IpAddress { get; set; }
    
    // ??????
    public DateTime ExpiresAt { get; set; }
    public bool IsRevoked { get; set; } = false;
    public DateTime? RevokedAt { get; set; }
}
```

**???????:**
- ? ???? ??????? ??????
- ? ???? Logout ?? ???? ????

---

### 10. ?? PasswordResetToken (???? ????? ???????)

**??????:** `Entities/Auth/PasswordResetToken.cs`

```csharp
public class PasswordResetToken : BaseEntity
{
    public string Token { get; set; } = string.Empty;
    public Guid UserId { get; set; }
    public User User { get; set; } = null!;
    
    public DateTime ExpiresAt { get; set; }
    public bool IsUsed { get; set; } = false;
    public DateTime? UsedAt { get; set; }
}
```

**???????:**
- ? ??? ???? ????? (One-Time Use)
- ? ????? ??? ???? ?????

---

## ?? ????????? (Enums)

### 1. PlanStatus (???? ?????)

```csharp
public enum PlanStatus
{
    Active,      // ????
    Completed,   // ??????
    Archived     // ??????
}
```

**?????????:**
- CareerPlan.Status
- StudyPlan.Status

---

### 2. CareerStepStatus (???? ???? ??????)

```csharp
public enum CareerStepStatus
{
    NotStarted,  // ?? ????
    InProgress,  // ??? ???????
    Completed    // ??????
}
```

**?????????:**
- CareerStep.Status

---

### 3. StepStatus (???? ?????? ??????)

```csharp
public enum StepStatus
{
    Locked,      // ????? (??? ????? ???)
    NotStarted,  // ?? ????
    InProgress,  // ??? ???????
    Completed,   // ??????
    Skipped      // ??????
}
```

---

### 4. SkillLevel (????? ???????)

```csharp
public enum SkillLevel
{
    Beginner,      // ????? (0-30)
    Intermediate,  // ????? (31-70)
    Advanced       // ????? (71-100)
}
```

**?????????:**
- UserSkill.Level

---

### 5. UserRole (??? ????????)

```csharp
public enum UserRole
{
    Student,  // ????
    Admin     // ?????
}
```

---

### 6. StudyLevel (??????? ???????)

```csharp
public enum StudyLevel
{
    Freshman,   // ??? ????
    Sophomore,  // ??? ?????
    Junior,     // ??? ?????
    Senior,     // ??? ?????
    Graduate    // ?????? ????
}
```

---

### 7. TaskPriority (?????? ??????)

```csharp
public enum TaskPriority
{
    Low,     // ??????
    Medium,  // ??????
    High     // ?????
}
```

---

### 8. TaskStatus (???? ??????)

```csharp
public enum TaskStatus
{
    Pending,     // ?????
    InProgress,  // ??? ???????
    Done         // ??????
}
```

---

## ?? ???????? ??? ????????

### ???? ???????? (ER Diagram)

```
???????????????????????????????????????????????????????????
?                  Entity Relationships                    ?
???????????????????????????????????????????????????????????

                    ????????????
                    ?   User   ?
                    ????????????
                          ?
          ???????????????????????????????????????????????
          ?               ?               ?             ?
          ?               ?               ?             ?
    ???????????    ??????????????  ????????????  ????????????
    ? Profile ?    ?CareerPlan  ?  ?StudyPlan ?  ?RefreshTk ?
    ???????????    ??????????????  ????????????  ????????????
         ?                ?
         ??????????       ?
         ?        ?       ?
         ?        ?       ?
    ?????????? ??????????????????????
    ?UserSkill? ?UserAch??CareerStep?
    ?????????? ??????????????????????
        ?
        ?
    ??????????
    ? Skill  ?
    ??????????

????????:
?????????
User 1:1 UserProfile
User 1:N CareerPlan
User 1:N StudyPlan
User 1:N RefreshToken
UserProfile 1:N UserSkill
UserProfile 1:N UserAchievement
Skill 1:N UserSkill
CareerPlan 1:N CareerStep
```

### ????? ????????

#### 1. User ? UserProfile (One-to-One)

```csharp
// ?? User
public UserProfile? UserProfile { get; set; }

// ?? UserProfile
public Guid UserId { get; set; }
public User User { get; set; } = null!;
```

#### 2. User ? CareerPlan (One-to-Many)

```csharp
// ?? User
public ICollection<CareerPlan> CareerPlans { get; set; } = new List<CareerPlan>();

// ?? CareerPlan
public Guid UserId { get; set; }
public User User { get; set; } = null!;
```

#### 3. CareerPlan ? CareerStep (One-to-Many)

```csharp
// ?? CareerPlan
public ICollection<CareerStep> Steps { get; set; } = new List<CareerStep>();

// ?? CareerStep
public Guid CareerPlanId { get; set; }
public CareerPlan CareerPlan { get; set; } = null!;
```

#### 4. UserProfile ? Skill (Many-to-Many via UserSkill)

```csharp
// ?? UserProfile
public ICollection<UserSkill> Skills { get; set; } = new List<UserSkill>();

// ?? Skill
public ICollection<UserSkill> UserSkills { get; set; } = new List<UserSkill>();

// ?? UserSkill (Join Table)
public Guid UserProfileId { get; set; }
public UserProfile UserProfile { get; set; } = null!;
public Guid SkillId { get; set; }
public Skill Skill { get; set; } = null!;
```

---

## ?? ????? ??????? (Business Rules)

### 1. User (????????)

```csharp
// ????? ??????
? Email ??? ?? ???? ????
? Password ??? ?? ???? 8 ???? ??? ?????
? FirstName ? LastName ????????
? ?? ???? ??? ???????? (Soft Delete ???)
```

### 2. CareerPlan (??? ?????? ??????)

```csharp
// ????? ???? ???????
? TimelineMonths ??? ?? ???? ??? 1 ? 60
? CurrentStepIndex ??? ?? ???? ??? 0 ? ??? ???????
? ???? ???????? ?? ???? ???? ??? ???? ????? ???
? ??? ????? ?????? ??? Completed? ??? ?? ???? ???? ??????? ??????
```

### 3. CareerStep (???? ??????)

```csharp
// ????? ??????
? ?? ???? ??? ???? ??? ??? ???? ?????? ??????? ??????
? ??? ????? ??????? ??? ??? CompletedAt
? DueDate ?? ???? ?? ???? ?? ??????
```

### 4. UserSkill (?????? ????????)

```csharp
// ????? ???????
? ProficiencyLevel ??? 0 ? 100
? Level ??? ?????? ???????? ????? ??? ProficiencyLevel:
    - Beginner: 0-30
    - Intermediate: 31-70
    - Advanced: 71-100
```

---

## ?? BaseEntity (?????? ???????)

### ???????

```csharp
public abstract class BaseEntity
{
    public Guid Id { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime? UpdatedAt { get; set; }
    public bool IsDeleted { get; set; } = false;
}
```

### ???????

- ? `Id` - ???? ???? (GUID)
- ? `CreatedAt` - ????? ???????
- ? `UpdatedAt` - ????? ??? ?????
- ? `IsDeleted` - ?????? Soft Delete

### ???????

1. **????? ???????** - ???? ???????? ??? ??? ???????
2. **Soft Delete** - ?? ??? ??? ???????? ??????
3. **Audit Trail** - ???? ??? ?? ?????/????? ?????
4. **GUID** - ?????? ???? ??????

### ???? ?????????

```csharp
// ???? ???????? ??? ?? BaseEntity
public class User : BaseEntity
{
    // ??? ??????? ?????? ?? User
    public string Email { get; set; }
    // Id, CreatedAt, UpdatedAt, IsDeleted ?????? ????????
}
```

---

## ?? ????? ??????? ?????????

### 1. Repository Pattern (?????)
```csharp
// ???? ?????? ?? Infrastructure
public interface IUserRepository
{
    Task<User> GetByIdAsync(Guid id);
    Task<IEnumerable<User>> GetAllAsync();
}
```

### 2. Specification Pattern (?????)
```csharp
// ??????????? ???????
public class ActiveCareerPlansSpecification
{
    public Expression<Func<CareerPlan, bool>> Criteria =>
        plan => plan.IsActive && !plan.IsDeleted;
}
```

### 3. Domain Events (?????)
```csharp
// ??????? ??????
public class CareerPlanCompletedEvent
{
    public Guid UserId { get; set; }
    public Guid PlanId { get; set; }
    public DateTime CompletedAt { get; set; }
}
```

---

## ?? ????? ??????

- [02-ENTITIES-GUIDE.md](./02-ENTITIES-GUIDE.md) - ???? ???????? ????????
- [03-ENUMS-REFERENCE.md](./03-ENUMS-REFERENCE.md) - ???? ?????????
- [06-BUSINESS-RULES.md](./06-BUSINESS-RULES.md) - ????? ??????? ?????????
- [entities/User.md](./entities/User.md) - ????? ???? User ?????????
- [entities/CareerPlan.md](./entities/CareerPlan.md) - ????? ???? CareerPlan ?????????

---

**??? ?????:** 2024-12-31  
**???????:** 1.0.0
