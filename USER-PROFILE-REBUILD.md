# User Profile System - Professional Rebuild

## ? ?? ????? ???? ?????? ??????? ???? ???????

---

## ?? ??????? ???? ?? ????

### ????? Backend
1. **Validation Inconsistency** - ??? CurrentLevel enum ???? ????? ?? API binding
2. **Poor Error Messages** - ????? ????? ??? ?????
3. **No Logging** - ????? ?? debugging
4. **Complex Timezone Validation** - ????? ???? ?????

### ????? Frontend
1. **State Management Chaos** - ????? state ????? ????
2. **No Form Validation** - validation ????
3. **Poor Error Handling** - ?? ???? ??????? ?????
4. **Too Much Console Logging** - console ???? ???? logs

---

## ??? ???? ?????????

### 1. Backend Changes

#### UpdateUserProfileDto.cs
```csharp
// ????? CurrentLevel ?? enum ??? int (0-4)
[Required(ErrorMessage = "Study level is required")]
[Range(0, 4, ErrorMessage = "Study level must be between 0 (Freshman) and 4 (Graduate)")]
public int CurrentLevel { get; set; }

// Helper method ?????? ??? enum
public StudyLevel GetStudyLevel() => (StudyLevel)CurrentLevel;
```

**???????:**
- ? API ???? ????? (???? ?? strings)
- ? Validation ????
- ? ?? ????? ?? enum binding

#### UserProfileService.cs
```csharp
// ????? ILogger
private readonly ILogger<UserProfileService> _logger;

// ??????? AsNoTracking ??????? (????)
.AsNoTracking()
.FirstOrDefaultAsync(...)

// Pattern matching ??? timezone suggestions
var suggestions = lowerLocation switch
{
    var l when l.Contains("jordan") => ...,
    var l when l.Contains("saudi") => ...,
    _ => CommonTimezones
};
```

**???????:**
- ? Better performance ?? AsNoTracking
- ? Cleaner code ?? pattern matching
- ? Professional logging

#### UserProfileController.cs
```csharp
// Error responses ?????
return BadRequest(new
{
    message = "Validation failed",
    errors = errors // Dictionary<string, string[]>
});
```

**???????:**
- ? Consistent error format
- ? Easy to parse ?? Frontend

---

### 2. Frontend Changes

#### userProfileService.js
```javascript
// ????? Study Level ?? string ??? number
const convertStudyLevelToNumber = (level) => {
  const levelMap = {
    'Freshman': 0,
    'Sophomore': 1,
    'Junior': 2,
    'Senior': 3,
    'Graduate': 4
  };
  return levelMap[level] ?? 0;
};

// ????? ???????? ??? ???????
const payload = {
  university: profileData.university?.trim() || '',
  currentLevel: convertStudyLevelToNumber(profileData.currentLevel),
  // ...
};
```

**???????:**
- ? Clean data transformation
- ? Proper null handling
- ? Less logging clutter

#### ProfileContext.jsx
```javascript
// ??????? useCallback
const loadProfile = useCallback(async () => {
  // ...
}, []);

// Error handling ?????
if (errorData.errors) {
  const errorList = Object.entries(errorData.errors)
    .map(([field, messages]) => `${field}: ${messages.join(', ')}`)
    .join('\n');
  errorMessage = `Validation failed:\n${errorList}`;
}
```

**???????:**
- ? Prevents unnecessary re-renders ?? useCallback
- ? Better error formatting
- ? Clean state management

#### Profile.jsx (????? ????? ?????)
```javascript
// Component structure ?????
<FormSection title="..." icon={...}>
  <FormField ... />
  <FormField ... />
</FormSection>

// Frontend validation ??? ???????
const validateForm = () => {
  const errors = [];
  if (!formData.university?.trim()) {
    errors.push('University is required');
  }
  // ...
  return errors;
};
```

**???????:**
- ? Reusable components
- ? Clear validation
- ? Better UX

---

## ?? ????????

| ?????? | ??? | ??? |
|--------|-----|-----|
| **Backend Validation** | ? ???? ???? ???? | ? ???? ????? |
| **Error Messages** | ? ???? | ? ????? ??? field |
| **Frontend State** | ? chaotic | ? clean ? organized |
| **Form Validation** | ? ???? | ? ??? ?????? (frontend + backend) |
| **Code Quality** | ? ????? | ? professional ? clean |
| **Logging** | ? ???? ???? | ? ??? ?? ???? |
| **Performance** | ? ???? | ? ???? (AsNoTracking) |

---

## ?? ????? ?????????

### 1. ??? ????? Backend
```bash
cd Server/src/Mentora.Api
dotnet run
```

**???:** ???? restart ??? Hot Reload ?? ???? ???? ????????? (async ? sync)

### 2. ??? ????? Frontend
```bash
cd Client
npm run dev
```

### 3. ????? Profile Update
1. ??? ????
2. ???? ??? Profile
3. ???? "Edit Profile"
4. ???? ?????? ????????:
   - University (required)
   - Major (required)
   - Graduation Year (2024-2050)
   - Study Level (?? ???????)
   - Timezone (?? ???????)
5. ???? "Save"

---

## ?? ?????? ????????

### Required Fields (???? ??????)
- ? University
- ? Major
- ? Expected Graduation Year (2024-2050)
- ? Current Level (Freshman-Graduate)
- ? Timezone (IANA format)

### Optional Fields (???????)
- Bio
- Location
- Phone Number (+962791234567)
- Date of Birth
- LinkedIn URL (https://...)
- GitHub URL (https://...)

---

## ?? Validation Rules

### University & Major
- Minimum 2 characters
- Maximum 200 characters

### Graduation Year
- Between 2024 and 2050

### Study Level
- 0 = Freshman
- 1 = Sophomore
- 2 = Junior
- 3 = Senior
- 4 = Graduate

### Timezone
- IANA format: `Asia/Amman`, `UTC`, etc.
- ??????? ?????? ???????? ??? ??????

### Phone Number (??? ?????)
- International format: `+962791234567`
- RegEx: `^\+?[1-9]\d{1,14}$`

### URLs (??? ??????)
- Must start with `http://` or `https://`

---

## ?? Debugging

### ??? ???? ????? validation:

1. **???? Browser Console** (F12)
2. ???? ??:
```javascript
Profile update failed: {
  status: 400,
  data: {
    errors: {
      "University": ["University is required"],
      "Timezone": ["Invalid timezone format"]
    }
  }
}
```

3. ????? ?? **??? field ??????** ? **????? ??????**

### ??? ???? ????? ?? Arabic text:
- ???? ?????? ????? ???? ????
- ??? ??? `????` ?? console? ??? ????? ??? ???
- ???? ?? **Network Tab** ? Request Payload
- ???? ???? ???? ?? UTF-8

---

## ?? ??????? ????

### Backend
- ? Clean Architecture maintained
- ? Proper separation of concerns
- ? Professional logging
- ? Efficient database queries

### Frontend
- ? Component-based architecture
- ? Reusable form components
- ? Clean state management
- ? Professional error handling

### Best Practices Applied
- ? SOLID principles
- ? DRY (Don't Repeat Yourself)
- ? Single Responsibility
- ? Clean Code
- ? Performance optimization

---

## ?? Next Steps

### ??????? ?????????
1. ????? **Avatar Upload** (?????? avatar placeholder ???)
2. ????? **Form Auto-save** (??? ??????)
3. ????? **Field-level validation** (validation ??? field ?????)
4. ????? **Progress indication** (???? ?????? ????? ?????)

---

## ?? ???????

?? ????? ???? ???? User Profile ???? ???????:
- ? Backend ???? ?????
- ? Frontend ??? ???? ?????????
- ? Validation ??? ??????
- ? Error handling ???? ?????
- ? Performance ?????
- ? Code quality ????

**???? ?????? ???? ???????! ??**

---

Created: 2025-01-01
Version: 2.0.0 (Professional Rebuild)
