# ?? ???? ??????? (Application Layer) - ???? ????

## ?? ?????????
- [???? ????](#????-????)
- [??????????](#??????????)
- [DTOs](#dtos)
- [????????](#????????)
- [????? ??????](#?????-??????)
- [????? ???????](#?????-???????)

---

## ?? ???? ????

???? Application ?? **?????? ???????** ??? API ? Domain:

```
???????????????????????????????????????????
?       Application Layer Role            ?
???????????????????????????????????????????
?                                         ?
?  API Layer (Controllers)                ?
?       ?                                 ?
?  Application Layer (Use Cases)          ?
?       ?                                 ?
?  Domain Layer (Business Logic)          ?
?                                         ?
???????????????????????????????????????????
```

### ??????? ????????

- ? ????? ??? Domain ???
- ? ???? ???????? (Interfaces)
- ? ????? ??? DTOs
- ? ????? ??? ????? ??????
- ? ?? ????? ??? ?????? ????? (DB, API, etc.)
- ? ?? ????? ??? Infrastructure
- ? ?? ????? ??? API

---

## ?? ??????????

### 1. ????? Use Cases (????? ?????????)

```csharp
public interface IAuthService
{
    // Use Case: ????? ?????? ????
    Task<AuthResponseDTO> RegisterAsync(SignupDTO dto);
    
    // Use Case: ????? ??????
    Task<AuthResponseDTO> LoginAsync(LoginDTO dto);
    
    // Use Case: ????? ?????
    Task<AuthResponseDTO> RefreshTokenAsync(string refreshToken);
}
```

### 2. ????? Data Transfer Objects (DTOs)

```csharp
// DTO ???????? ???????? ?? API
public class SignupDTO
{
    public string FirstName { get; set; } = string.Empty;
    public string LastName { get; set; } = string.Empty;
    public string Email { get; set; } = string.Empty;
    public string Password { get; set; } = string.Empty;
}

// DTO ?????? ???????? ??? API
public class AuthResponseDTO
{
    public bool IsSuccess { get; set; }
    public string Message { get; set; } = string.Empty;
    public string? AccessToken { get; set; }
    public string? RefreshToken { get; set; }
    public UserDTO? User { get; set; }
}
```

### 3. ????? Abstractions (?????????)

```csharp
// ????? Repository
public interface IUserRepository
{
    Task<User?> GetByIdAsync(Guid id);
    Task<User?> GetByEmailAsync(string email);
    Task<bool> EmailExistsAsync(string email);
    Task AddAsync(User user);
}

// ????? External Service
public interface IEmailService
{
    Task SendEmailAsync(string to, string subject, string body);
}
```

---

## ?? DTOs (Data Transfer Objects)

### ?????? DTOs

```
Mentora.Application/DTOs/
??? Auth/
?   ??? LoginDTO.cs
?   ??? SignupDTO.cs
?   ??? ForgotPasswordDto.cs
?   ??? ResetPasswordDto.cs
?   ??? AuthResponseDTO.cs
??? User/
?   ??? UserDTO.cs
?   ??? UserProfileDTO.cs
?   ??? UpdateProfileDTO.cs
??? Career/
?   ??? CareerPlanDTO.cs
?   ??? CareerStepDTO.cs
?   ??? CreateCareerPlanDTO.cs
?   ??? UpdateCareerPlanDTO.cs
??? Common/
    ??? PagedResult.cs
    ??? ApiResponse.cs
```

### ????? ???????

#### 1. DTOs ????????

```csharp
// DTOs/Auth/LoginDTO.cs
public class LoginDTO
{
    [Required(ErrorMessage = "?????? ?????????? ?????")]
    [EmailAddress(ErrorMessage = "???? ?????? ?????????? ??? ?????")]
    public string Email { get; set; } = string.Empty;
    
    [Required(ErrorMessage = "???? ?????? ??????")]
    [MinLength(8, ErrorMessage = "???? ?????? ??? ?? ???? 8 ???? ??? ?????")]
    public string Password { get; set; } = string.Empty;
    
    public string? DeviceInfo { get; set; }
}

// DTOs/Auth/SignupDTO.cs
public class SignupDTO
{
    [Required]
    [MaxLength(50)]
    public string FirstName { get; set; } = string.Empty;
    
    [Required]
    [MaxLength(50)]
    public string LastName { get; set; } = string.Empty;
    
    [Required]
    [EmailAddress]
    public string Email { get; set; } = string.Empty;
    
    [Required]
    [MinLength(8)]
    [RegularExpression(@"^(?=.*[A-Z])(?=.*[!@#$%^&*]).*$", 
        ErrorMessage = "??? ?? ????? ??? ??? ???? ???? ???")]
    public string Password { get; set; } = string.Empty;
    
    [Compare("Password", ErrorMessage = "????? ?????? ??? ???????")]
    public string ConfirmPassword { get; set; } = string.Empty;
}

// DTOs/Auth/AuthResponseDTO.cs
public class AuthResponseDTO
{
    public bool IsSuccess { get; set; }
    public string Message { get; set; } = string.Empty;
    public string? AccessToken { get; set; }
    public string? RefreshToken { get; set; }
    public UserDTO? User { get; set; }
    public DateTime? TokenExpiresAt { get; set; }
}
```

#### 2. DTOs ????????

```csharp
// DTOs/User/UserDTO.cs
public class UserDTO
{
    public Guid Id { get; set; }
    public string FirstName { get; set; } = string.Empty;
    public string LastName { get; set; } = string.Empty;
    public string Email { get; set; } = string.Empty;
    public string FullName { get; set; } = string.Empty;
    public bool IsEmailConfirmed { get; set; }
    public DateTime CreatedAt { get; set; }
}

// DTOs/User/UserProfileDTO.cs
public class UserProfileDTO
{
    public Guid UserId { get; set; }
    public string? Bio { get; set; }
    public DateTime? DateOfBirth { get; set; }
    public string? PhoneNumber { get; set; }
    public string? CurrentRole { get; set; }
    public string? TargetRole { get; set; }
    public int? YearsOfExperience { get; set; }
    public List<UserSkillDTO> Skills { get; set; } = new();
    public List<UserAchievementDTO> Achievements { get; set; } = new();
}
```

#### 3. DTOs ?????? ??????

```csharp
// DTOs/Career/CreateCareerPlanDTO.cs
public class CreateCareerPlanDTO
{
    [Required]
    [MaxLength(200)]
    public string Title { get; set; } = string.Empty;
    
    [Required]
    [MaxLength(100)]
    public string TargetRole { get; set; } = string.Empty;
    
    [MaxLength(1000)]
    public string? Description { get; set; }
    
    [Range(1, 60, ErrorMessage = "????? ??? ?? ???? ??? 1 ? 60 ???")]
    public int TimelineMonths { get; set; } = 12;
}

// DTOs/Career/CareerPlanDTO.cs
public class CareerPlanDTO
{
    public Guid Id { get; set; }
    public Guid UserId { get; set; }
    public string Title { get; set; } = string.Empty;
    public string TargetRole { get; set; } = string.Empty;
    public string Description { get; set; } = string.Empty;
    public string Summary { get; set; } = string.Empty;
    public int TimelineMonths { get; set; }
    public int CurrentStepIndex { get; set; }
    public bool IsActive { get; set; }
    public PlanStatus Status { get; set; }
    public DateTime CreatedAt { get; set; }
    public List<CareerStepDTO> Steps { get; set; } = new();
    public int ProgressPercentage { get; set; }
}
```

#### 4. DTOs ??????

```csharp
// DTOs/Common/PagedResult.cs
public class PagedResult<T>
{
    public List<T> Items { get; set; } = new();
    public int TotalCount { get; set; }
    public int PageNumber { get; set; }
    public int PageSize { get; set; }
    public int TotalPages => (int)Math.Ceiling(TotalCount / (double)PageSize);
    public bool HasPrevious => PageNumber > 1;
    public bool HasNext => PageNumber < TotalPages;
}

// DTOs/Common/ApiResponse.cs
public class ApiResponse<T>
{
    public bool IsSuccess { get; set; }
    public string Message { get; set; } = string.Empty;
    public T? Data { get; set; }
    public List<string> Errors { get; set; } = new();
    
    public static ApiResponse<T> Success(T data, string message = "??? ??????? ?????")
    {
        return new ApiResponse<T>
        {
            IsSuccess = true,
            Message = message,
            Data = data
        };
    }
    
    public static ApiResponse<T> Failure(string message, List<string>? errors = null)
    {
        return new ApiResponse<T>
        {
            IsSuccess = false,
            Message = message,
            Errors = errors ?? new List<string>()
        };
    }
}
```

---

## ?? ???????? (Interfaces)

### ?????? ????????

```
Mentora.Application/Interfaces/
??? Services/
?   ??? IAuthService.cs
?   ??? ICareerService.cs
?   ??? IEmailService.cs
?   ??? IAiService.cs
??? Repositories/
    ??? IGenericRepository.cs
    ??? IUserRepository.cs
    ??? ICareerPlanRepository.cs
```

### ????? ???????

#### 1. ???? ????????

```csharp
// Interfaces/Services/IAuthService.cs
public interface IAuthService
{
    /// <summary>
    /// ????? ?????? ????
    /// </summary>
    Task<AuthResponseDTO> RegisterAsync(SignupDTO dto);
    
    /// <summary>
    /// ????? ??????
    /// </summary>
    Task<AuthResponseDTO> LoginAsync(LoginDTO dto);
    
    /// <summary>
    /// ????? ????? ???????? Refresh Token
    /// </summary>
    Task<AuthResponseDTO> RefreshTokenAsync(string refreshToken);
    
    /// <summary>
    /// ????? ???? ????? ????? ???? ??????
    /// </summary>
    Task<bool> ForgotPasswordAsync(ForgotPasswordDto dto);
    
    /// <summary>
    /// ????? ????? ???? ??????
    /// </summary>
    Task<bool> ResetPasswordAsync(ResetPasswordDto dto);
    
    /// <summary>
    /// ????? ?????? ?? ?????? ??????
    /// </summary>
    Task<bool> LogoutAsync(Guid userId, string refreshToken);
    
    /// <summary>
    /// ????? ?????? ?? ???? ???????
    /// </summary>
    Task<bool> LogoutAllAsync(Guid userId);
    
    /// <summary>
    /// ?????? ??? ??????? ???????? ??????
    /// </summary>
    Task<UserDTO?> GetCurrentUserAsync(Guid userId);
}
```

#### 2. ???? ?????? ??????

```csharp
// Interfaces/Services/ICareerService.cs
public interface ICareerService
{
    Task<CareerPlanDTO> CreatePlanAsync(Guid userId, CreateCareerPlanDTO dto);
    Task<CareerPlanDTO?> GetPlanAsync(Guid planId, Guid userId);
    Task<List<CareerPlanDTO>> GetUserPlansAsync(Guid userId);
    Task<CareerPlanDTO> UpdatePlanAsync(Guid planId, Guid userId, UpdateCareerPlanDTO dto);
    Task<bool> DeletePlanAsync(Guid planId, Guid userId);
    Task<bool> ActivatePlanAsync(Guid planId, Guid userId);
    Task<bool> CompletePlanAsync(Guid planId, Guid userId);
    Task<CareerStepDTO> UpdateStepStatusAsync(Guid stepId, Guid userId, CareerStepStatus status);
}
```

#### 3. ?????? ???

```csharp
// Interfaces/Repositories/IGenericRepository.cs
public interface IGenericRepository<T> where T : BaseEntity
{
    Task<T?> GetByIdAsync(Guid id);
    Task<IEnumerable<T>> GetAllAsync();
    Task<IEnumerable<T>> FindAsync(Expression<Func<T, bool>> predicate);
    Task AddAsync(T entity);
    Task AddRangeAsync(IEnumerable<T> entities);
    void Update(T entity);
    void Remove(T entity);
    void RemoveRange(IEnumerable<T> entities);
}
```

#### 4. ?????? ??????????

```csharp
// Interfaces/Repositories/IUserRepository.cs
public interface IUserRepository : IGenericRepository<User>
{
    Task<User?> GetByEmailAsync(string email);
    Task<bool> EmailExistsAsync(string email);
    Task<User?> GetWithProfileAsync(Guid userId);
    Task<User?> GetWithCareerPlansAsync(Guid userId);
}
```

---

## ? ????? ?????? (Validation)

### ??????? Data Annotations

```csharp
public class SignupDTO
{
    [Required(ErrorMessage = "????? ????? ?????")]
    [MaxLength(50, ErrorMessage = "????? ????? ?? ???? ?? ?????? 50 ???")]
    [MinLength(2, ErrorMessage = "????? ????? ??? ?? ???? ????? ??? ?????")]
    public string FirstName { get; set; } = string.Empty;
    
    [Required(ErrorMessage = "?????? ?????????? ?????")]
    [EmailAddress(ErrorMessage = "???? ?????? ?????????? ??? ?????")]
    public string Email { get; set; } = string.Empty;
    
    [Required(ErrorMessage = "???? ?????? ??????")]
    [MinLength(8, ErrorMessage = "???? ?????? ??? ?? ???? 8 ???? ??? ?????")]
    [RegularExpression(@"^(?=.*[A-Z])(?=.*[!@#$%^&*]).*$")]
    public string Password { get; set; } = string.Empty;
    
    [Compare("Password", ErrorMessage = "????? ?????? ??? ???????")]
    public string ConfirmPassword { get; set; } = string.Empty;
}
```

### FluentValidation (???? - ???????)

```csharp
// Validators/SignupDTOValidator.cs
public class SignupDTOValidator : AbstractValidator<SignupDTO>
{
    public SignupDTOValidator()
    {
        RuleFor(x => x.FirstName)
            .NotEmpty().WithMessage("????? ????? ?????")
            .MaximumLength(50).WithMessage("????? ????? ???? ????")
            .MinimumLength(2).WithMessage("????? ????? ???? ????");
            
        RuleFor(x => x.Email)
            .NotEmpty().WithMessage("?????? ?????????? ?????")
            .EmailAddress().WithMessage("???? ?????? ??? ?????");
            
        RuleFor(x => x.Password)
            .NotEmpty().WithMessage("???? ?????? ??????")
            .MinimumLength(8).WithMessage("???? ?????? ????? ????")
            .Matches(@"[A-Z]").WithMessage("??? ?? ????? ??? ??? ????")
            .Matches(@"[!@#$%^&*]").WithMessage("??? ?? ????? ??? ??? ???");
            
        RuleFor(x => x.ConfirmPassword)
            .Equal(x => x.Password).WithMessage("????? ?????? ??? ???????");
    }
}
```

---

## ?? ????? ??????? (Design Patterns)

### 1. Repository Pattern

```csharp
// ???? ???? ?????? ????????
public interface IUserRepository
{
    Task<User?> GetByIdAsync(Guid id);
}

// ?????? ?????? Repository
public class AuthService : IAuthService
{
    private readonly IUserRepository _userRepository;
    
    public async Task<UserDTO?> GetUserAsync(Guid id)
    {
        var user = await _userRepository.GetByIdAsync(id);
        return MapToDTO(user);
    }
}
```

### 2. Service Pattern

```csharp
// ?? Use Case ?? Service
public interface IAuthService { }
public interface ICareerService { }
public interface IEmailService { }
```

### 3. DTO Pattern

```csharp
// ??? ??? Domain Model ? Data Transfer
// Domain Model (?? Domain Layer)
public class User
{
    public string PasswordHash { get; set; } // ????
}

// DTO (?? Application Layer)
public class UserDTO
{
    // ?? ????? ??? PasswordHash (???)
    public string Email { get; set; }
}
```

### 4. CQRS (???? - Command Query Responsibility Segregation)

```csharp
// Commands (????? ??????)
public interface ICommand<TResult>
{
    Task<TResult> ExecuteAsync();
}

// Queries (????? ???)
public interface IQuery<TResult>
{
    Task<TResult> ExecuteAsync();
}

// ????
public class CreateCareerPlanCommand : ICommand<CareerPlanDTO>
{
    public CreateCareerPlanDTO Data { get; set; }
}
```

---

## ?? ???? ????????

```
??????????????????????????????????????????
?       Application Layer Dependencies    ?
??????????????????????????????????????????

Application
    ??? Depends on:
    ?   ??? Domain ?
    ?
    ??? Used by:
        ??? Infrastructure ?
        ??? API ?

? ?? ????? ???:
    - Infrastructure
    - API
    - External Libraries (??? ???????)
```

---

## ?? ????? ??????

- [../architecture/01-ARCHITECTURE-OVERVIEW.md](../architecture/01-ARCHITECTURE-OVERVIEW.md)
- [../domain/01-DOMAIN-OVERVIEW.md](../domain/01-DOMAIN-OVERVIEW.md)
- [02-SERVICES-GUIDE.md](./02-SERVICES-GUIDE.md)
- [03-DTOS-REFERENCE.md](./03-DTOS-REFERENCE.md)

---

**??? ?????:** 2024-12-31  
**???????:** 1.0.0
